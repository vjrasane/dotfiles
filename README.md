# dotfiles

Personal dotfiles managed with Nix Home Manager.

## Setup on a new machine

### 1. Install Nix

```bash
# Multi-user installation (recommended)
sh <(curl -L https://nixos.org/nix/install) --daemon

# Or single-user installation
sh <(curl -L https://nixos.org/nix/install) --no-daemon
```

Restart your shell or run:
```bash
. /etc/profile.d/nix.sh
```

### 2. Enable flakes

```bash
mkdir -p ~/.config/nix
echo "experimental-features = nix-command flakes" >> ~/.config/nix/nix.conf
```

### 3. Clone this repository

```bash
git clone https://github.com/vjrasane/dotfiles.git ~/dotfiles
```

### 4. Create local configuration

```bash
cp ~/dotfiles/.config/home-manager/local.nix.example \
   ~/dotfiles/.config/home-manager/local.nix
```

Edit `local.nix` with your machine-specific settings:
- `username` - your username
- `homeDirectory` - your home directory path
- `system` - architecture (`x86_64-linux`, `aarch64-linux`, `x86_64-darwin`, `aarch64-darwin`)
- `gitUser`, `gitEmail`, `gitSigningKey` - git configuration
- `isWsl` - set to `true` if running in WSL

### 5. Apply Home Manager configuration

```bash
nix run home-manager/master -- switch --flake ~/dotfiles/.config/home-manager#<username>
```

Replace `<username>` with your username from local.nix.

This installs all packages and creates symlinks from your home directory to the dotfiles repo.

### 6. Set zsh as default shell

```bash
echo "$(which zsh)" | sudo tee -a /etc/shells
chsh -s $(which zsh)
```

### 7. Install additional tools

```bash
# Tmux Plugin Manager (then press prefix + I in tmux)
git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm

# Rust toolchain
rustup default stable
```

Antidote (zsh plugin manager) auto-installs on first shell start.

## Updating

```bash
# After editing home.nix
home-manager switch --flake ~/.config/home-manager

# Update flake inputs
nix flake update ~/.config/home-manager
```

## Directory structure

```
~/dotfiles/
├── .config/
│   ├── home-manager/     # Nix Home Manager config
│   │   ├── flake.nix
│   │   ├── home.nix
│   │   ├── local.nix     # Machine-specific (git-ignored)
│   │   └── local.nix.example
│   ├── git/
│   │   └── config.shared # Shared git settings (aliases, etc.)
│   ├── nvim/             # Neovim config
│   ├── jj/               # Jujutsu config
│   └── tmux/             # Tmux themes
├── zshrc/                # Modular zsh config
├── .zsh_plugins.txt
├── .p10k.zsh
└── .tmux.conf
```

## What gets symlinked

Home Manager creates these symlinks automatically:

```
~/.tmux.conf       -> ~/dotfiles/.tmux.conf
~/.p10k.zsh        -> ~/dotfiles/.p10k.zsh
~/.zsh_plugins.txt -> ~/dotfiles/.zsh_plugins.txt
~/zshrc            -> ~/dotfiles/zshrc
~/.config/nvim     -> ~/dotfiles/.config/nvim
~/.config/jj       -> ~/dotfiles/.config/jj
~/.config/tmux     -> ~/dotfiles/.config/tmux
~/.config/home-manager -> ~/dotfiles/.config/home-manager
```

Note: `~/.gitconfig` is generated by Home Manager (via `programs.git`), which includes shared settings from `~/dotfiles/.config/git/config.shared`.
